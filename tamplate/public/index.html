<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WhatsApp Bot - TOPAI</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <h2>WhatsApp Bot-TOPAI - Hacker Mode</h2>
  <input type="text" id="numbers" placeholder="N√∫meros separados por v√≠rgula (ex: 258872960710)" />
  <button onclick="sendMessage()">Enviar Mensagem</button>
  <p id="status"></p>
  <p id="loading" style="display:none;">Enviando mensagens... Aguarde.</p>

  <script>
    const mensagemIntro = `üëã Ol√°! Vimos que entraste em contacto connosco atrav√©s do nosso an√∫ncio.

Temos ofertas incr√≠veis para ti em pacotes de megas VODACOM! Confere abaixo a tabela completa com os nossos pre√ßos mais atualizados. üì∂üí∞`;

    const mensagemTabela = `üì¢ *TABELA DE MEGAS VODACOM*  
‚ìò *‚ùóüõëMEGABYTE VODACOM*

üìÖ *TABELA ATUALIZADA EM: 04/05/2025*  
üïì *Validade: 1 DIA*  
üì∂ 1.100MB = *20MT*  
üì∂ 1.650MB = *30MT*  
üì∂ 2.200MB = *40MT*  
üì∂ 2.750MB = *50MT*  
üì∂ 3.300MB = *60MT*  
üì∂ 4.400MB = *80MT*  
üì∂ 5.500MB = *100MT*  
üì∂ 10.000MB = *180MT*  
üì∂ 15.000MB = *280MT*  
üì∂ 20.000MB = *360MT*  

üóìÔ∏è *PACOTES MENSAIS (30 DIAS):*  
üì∂ 5.000MB = *130MT*  
üì∂ 6.100MB = *150MT*  
üì∂ 7.200MB = *170MT*  
üì∂ 9.400MB = *210MT*  
üì∂ 10.500MB = *260MT*  
üì∂ 20.000MB = *520MT*  
üì∂ 50.250MB = *1150MT*  
---

üöÄ _Conectando pessoas,_  
üöÄ _compartilhando megabytes!_

üí° *Atendimento das 6h √†s 23h*  
üîó *Entre j√° no nosso grupo de ofertas e receba atualiza√ß√µes em primeira m√£o:*  
üëâ https://chat.whatsapp.com/DsP45qnxmpYL1LARsYP68F`;

    const mensagemDesconto = `üéÅ *Aten√ß√£o!* Se recebeste esta mensagem, tens direito a um desconto exclusivo! üòç

Qual pacote vais querer aproveitar com desconto hoje?

üîó *N√£o percas as pr√≥ximas ofertas!* Entra j√° no nosso grupo VIP:  
üëâ https://chat.whatsapp.com/DsP45qnxmpYL1LARsYP68F`;

    async function sendMessage() {
      const numbers = document.getElementById("numbers").value.split(",").map(n => n.trim()).filter(n => n);
      const status = document.getElementById("status");
      const loading = document.getElementById("loading");

      if (numbers.length === 0) {
        status.innerText = "Por favor, preencha os n√∫meros!";
        return;
      }

      loading.style.display = "block";
      status.innerText = "Iniciando envio de mensagens...";

      try {
        for (let i = 0; i < numbers.length; i++) {
          const number = numbers[i];

          // Tempo aleat√≥rio entre 4 e 6 minutos
          let minTime = 4 * 60;
          let maxTime = 6 * 60;
          let totalIntervalSeconds = Math.floor(Math.random() * (maxTime - minTime + 1)) + minTime;

          function updateCountdown() {
            let minutes = Math.floor(totalIntervalSeconds / 60);
            let seconds = totalIntervalSeconds % 60;
            status.innerText = `Aguarde ${minutes}m ${seconds}s para enviar a mensagem para ${number}`;
            if (totalIntervalSeconds > 0) {
              totalIntervalSeconds--;
            } else {
              clearInterval(countdownInterval);
              status.innerText = `Enviando mensagens para ${number}...`;
            }
          }

          const countdownInterval = setInterval(updateCountdown, 1000);
          await new Promise(resolve => setTimeout(resolve, totalIntervalSeconds * 1000));
          clearInterval(countdownInterval);

          await sendToWhatsApp(number, mensagemIntro);
          await new Promise(resolve => setTimeout(resolve, 7000));
          await sendToWhatsApp(number, mensagemTabela);
          await new Promise(resolve => setTimeout(resolve, 5000));
          await sendToWhatsApp(number, mensagemDesconto);

          status.innerText = `Mensagens enviadas para ${number}`;
        }

        status.innerText = "‚úÖ Todas as mensagens foram enviadas com sucesso!";
      } catch (error) {
        status.innerText = "‚ùå Erro ao enviar mensagens!";
        console.error(error);
      } finally {
        loading.style.display = "none";
      }
    }

    async function sendToWhatsApp(number, message) {
      try {
        const numberWithSuffix = `${number}@c.us`;
        const response = await fetch("http://localhost:3000/send", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ numbers: [numberWithSuffix], message })
        });

        const data = await response.json();
        console.log("Resposta do servidor:", data);
      } catch (error) {
        console.error("Erro ao enviar para o WhatsApp:", error);
      }
    }
  </script>
</body>
</html>
